{% extends 'core/base.html' %}
{% block content %}

<style>
    /* Estilos para la tabla de movimientos financieros */
    .table-modern thead th {
        background: rgba(248, 250, 252, 0.5);
        color: var(--text-muted);
        font-size: 0.7rem;
        text-transform: uppercase;
        font-weight: 800;
        letter-spacing: 0.5px;
        padding: 15px;
        border-bottom: 2px solid var(--glass-border);
    }

    .table-modern tbody td {
        padding: 16px 15px;
        vertical-align: middle;
        border-bottom: 1px solid rgba(0,0,0,0.03);
        font-size: 0.85rem;
    }

    /* Badges Soft para Flujo de Efectivo */
    .badge-flow {
        padding: 6px 12px;
        border-radius: 8px;
        font-weight: 700;
        font-size: 0.7rem;
        display: inline-flex;
        align-items: center;
        gap: 5px;
    }
    .badge-ingreso { 
        background: rgba(16, 185, 129, 0.1); 
        color: #10b981; 
        border: 1px solid rgba(16, 185, 129, 0.2); 
    }
    .badge-egreso { 
        background: rgba(239, 68, 68, 0.1); 
        color: #ef4444; 
        border: 1px solid rgba(239, 68, 68, 0.2); 
    }

    .amount-val {
        font-family: 'Inter', sans-serif;
        font-weight: 800;
        font-size: 1rem;
        letter-spacing: -0.5px;
    }

    .ref-text {
        font-weight: 600;
        color: var(--text-dark);
        display: block;
    }
</style>

<div class="dashboard-container">
    <!-- Encabezado con Estilo Fintech -->
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4 gap-3">
        <div>
            <h3 class="fw-800 mb-1" style="color: var(--text-dark); letter-spacing: -1px;">
                <i class="fa-solid fa-money-bill-transfer text-primary me-2"></i> Movimientos de Caja y Bancos
            </h3>
            <p class="text-muted small mb-0">Historial consolidado de entradas y salidas de efectivo</p>
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-white border shadow-sm rounded-3 px-3">
                <i class="fa-solid fa-download me-2 text-primary"></i> Reporte
            </button>
        </div>
    </div>

    <!-- Contenedor Principal (Glassmorphism) -->
    <div class="glass-card p-0 overflow-hidden shadow-sm">
        <div class="table-responsive">
            <table class="table table-modern align-middle mb-0">
                <thead>
                    <tr>
                        <th style="width: 15%;">Fecha y Hora</th>
                        <th style="width: 40%;">Referencia / Motivo</th>
                        <th style="width: 15%; text-align: center;">Tipo</th>
                        <th style="width: 10%; text-align: center;">Moneda</th>
                        <th style="width: 20%; text-align: right;">Monto</th>
                    </tr>
                </thead>
                <tbody>
                    {% for m in movimientos %}
                    <tr>
                        <!-- 1. Fecha -->
                        <td>
                            <div class="text-dark fw-bold">{{ m.fecha|date:"d M, Y" }}</div>
                            <small class="text-muted">{{ m.fecha|date:"H:i a" }}</small>
                        </td>

                        <!-- 2. Referencia -->
                        <td>
                            <span class="ref-text">{{ m.referencia }}</span>
                            <small class="text-muted"><i class="fa-solid fa-tag me-1 small"></i> ID Mov: #{{ m.id }}</small>
                        </td>

                        <!-- 3. Tipo con Icono dinÃ¡mico -->
                        <td class="text-center">
                            {% if m.tipo == 'Ingreso' %}
                                <span class="badge-flow badge-ingreso">
                                    <i class="fa-solid fa-circle-arrow-up"></i> INGRESO
                                </span>
                            {% else %}
                                <span class="badge-flow badge-egreso">
                                    <i class="fa-solid fa-circle-arrow-down"></i> EGRESO
                                </span>
                            {% endif %}
                        </td>

                        <!-- 4. Moneda -->
                        <td class="text-center">
                            <span class="badge bg-light text-dark border px-2 py-1">{{ m.moneda }}</span>
                        </td>

                        <!-- 5. Monto alineado y con color -->
                        <td class="text-end">
                            <span class="amount-val {% if m.tipo == 'Ingreso' %}text-success{% else %}text-danger{% endif %}">
                                {% if m.tipo == 'Egreso' %}-{% else %}+{% endif %} 
                                {% if m.moneda == 'USD' %}${% else %}S/{% endif %} {{ m.monto|floatformat:2 }}
                            </span>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center py-5">
                            <i class="fa-solid fa-receipt fa-3x text-muted opacity-25 mb-3"></i>
                            <p class="text-muted">No hay movimientos registrados en este periodo.</p>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

{% endblock %}