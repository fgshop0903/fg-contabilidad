{% extends 'core/base.html' %}
{% block content %}

<style>
    /* Estilos específicos para Cotizaciones */
    .table-modern-quotes thead th {
        background: rgba(248, 250, 252, 0.5);
        color: var(--text-muted);
        font-size: 0.7rem;
        text-transform: uppercase;
        font-weight: 800;
        letter-spacing: 0.5px;
        padding: 15px;
        border-bottom: 2px solid var(--glass-border);
    }

    .table-modern-quotes tbody td {
        padding: 16px 15px;
        vertical-align: middle;
        border-bottom: 1px solid rgba(0,0,0,0.03);
        font-size: 0.85rem;
    }

    .table-modern-quotes tbody tr:hover {
        background-color: var(--primary-soft);
        transition: background 0.2s;
    }

    /* Status Badges Fintech Style */
    .badge-soft {
        padding: 6px 12px;
        border-radius: 8px;
        font-weight: 700;
        font-size: 0.7rem;
        display: inline-flex;
        align-items: center;
        gap: 5px;
    }
    .badge-soft-pending { background: rgba(245, 158, 11, 0.1); color: #d97706; border: 1px solid rgba(245, 158, 11, 0.2); }
    .badge-soft-success { background: rgba(16, 185, 129, 0.1); color: #10b981; border: 1px solid rgba(16, 185, 129, 0.2); }

    .quote-number {
        font-family: 'Monaco', 'Consolas', monospace;
        background: #f1f5f9;
        padding: 3px 8px;
        border-radius: 6px;
        color: var(--primary);
        font-weight: 700;
    }

    /* Buscador Pro */
    .search-container {
        position: relative;
    }
    .search-container i {
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-muted);
    }
    .search-input {
        padding-left: 40px !important;
        border-radius: 12px !important;
        border: 1px solid var(--glass-border) !important;
        background: rgba(255, 255, 255, 0.5) !important;
        transition: all 0.3s;
    }
    .search-input:focus {
        background: white !important;
        box-shadow: 0 0 0 4px var(--primary-soft) !important;
    }

    .btn-action {
        width: 36px;
        height: 36px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border-radius: 10px;
        background: white;
        border: 1px solid var(--glass-border);
        color: var(--text-muted);
        transition: all 0.2s;
    }
    .btn-action:hover {
        color: var(--primary);
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }
</style>

<div class="dashboard-container">
    <!-- Encabezado responsivo -->
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4 gap-3">
        <div>
            <h3 class="fw-800 mb-1" style="color: var(--text-dark); letter-spacing: -1px;">
                <i class="fa-solid fa-file-signature text-primary me-2"></i> Mis Cotizaciones
            </h3>
            <p class="text-muted small mb-0">Gestión de presupuestos y propuestas comerciales</p>
        </div>
        <a href="{% url 'registrar_cotizacion' %}" class="btn btn-primary shadow-sm px-4 py-2 rounded-3 fw-bold">
            <i class="fa-solid fa-plus me-2"></i> Crear Nueva Cotización
        </a>
    </div>

    <!-- Buscador Minimalista -->
    <div class="glass-card mb-4 p-3 border-0">
        <div class="row">
            <div class="col-lg-4 col-md-6">
                <div class="search-container">
                    <i class="fa-solid fa-magnifying-glass"></i>
                    <input type="text" id="busquedaCot" class="form-control search-input" placeholder="Buscar por cliente, RUC o número...">
                </div>
            </div>
        </div>
    </div>

    <!-- Contenedor de Tabla con Scroll Responsivo -->
    <div class="glass-card p-0 overflow-hidden shadow-sm">
        <div class="table-responsive">
            <table class="table table-modern-quotes mb-0" id="tablaCotizaciones">
                <thead>
                    <tr>
                        <th class="ps-4">N° Cotización</th>
                        <th>Fecha Emisión</th>
                        <th>Cliente / Entidad</th>
                        <th class="text-end">Monto Total</th>
                        <th class="text-center">Estado</th>
                        <th class="text-center">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for c in cotizaciones %}
                    <tr>
                        <!-- 1. Número -->
                        <td class="ps-4">
                            <span class="quote-number text-uppercase">{{ c.numero }}</span>
                        </td>

                        <!-- 2. Fecha -->
                        <td>
                            <div class="fw-bold text-dark">{{ c.fecha|date:"d M, Y" }}</div>
                            <small class="text-muted">Expira en 15 días</small>
                        </td>

                        <!-- 3. Cliente -->
                        <td>
                            <div class="fw-800 text-dark" style="font-size: 0.9rem;">{{ c.nombre_cliente|truncatechars:40 }}</div>
                            <div class="d-flex align-items-center gap-2 mt-1">
                                <span class="badge bg-light text-muted border fw-normal" style="font-size: 0.65rem;">ID: {{ c.ruc_dni_cliente }}</span>
                            </div>
                        </td>

                        <!-- 4. Total -->
                        <td class="text-end">
                            <div class="fw-800" style="font-size: 1rem; color: var(--text-dark);">
                                <small class="fw-normal text-muted">{% if c.moneda == 'USD' %}${% else %}S/{% endif %}</small> 
                                {{ c.total|floatformat:2 }}
                            </div>
                            <small class="text-muted" style="font-size: 0.65rem;">Incluye impuestos</small>
                        </td>

                        <!-- 5. Estado -->
                        <td class="text-center">
                            {% if c.estado == 'Pendiente' %}
                                <span class="badge-soft badge-soft-pending">
                                    <i class="fa-solid fa-clock-rotate-left"></i> PENDIENTE
                                </span>
                            {% else %}
                                <span class="badge-soft badge-soft-success">
                                    <i class="fa-solid fa-circle-check"></i> ACEPTADA
                                </span>
                            {% endif %}
                        </td>

                        <!-- 6. Acciones -->
                        <td class="text-center">
                            <div class="d-flex justify-content-center gap-2">
                                <a href="{% url 'ver_cotizacion_guardada' c.id %}" class="btn-action" title="Ver Detalle">
                                    <i class="fa-solid fa-eye"></i>
                                </a>
                                <a href="{% url 'editar_cotizacion' c.id %}" class="btn-action" title="Editar Cotización">
                                    <i class="fa-solid fa-pen-to-square"></i>                              
                                </a>
                                <!--<a href="{% url 'ver_cotizacion_guardada' c.id %}?export=1" target="_blank" class="btn-action" title="Descargar PDF">
                                    <i class="fa-solid fa-file-pdf text-danger"></i>
                                </a>-->
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="text-center py-5">
                            <div class="opacity-25 mb-3">
                                <i class="fa-solid fa-file-circle-exclamation fa-4x text-muted"></i>
                            </div>
                            <h5 class="text-muted fw-light">No hay cotizaciones registradas</h5>
                            <p class="text-muted small">Crea tu primer presupuesto para empezar a vender.</p>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Script de búsqueda rápida mejorado -->
<script>
    document.getElementById('busquedaCot').addEventListener('keyup', function() {
        let input = this.value.toLowerCase();
        let rows = document.querySelectorAll("#tablaCotizaciones tbody tr");
        
        rows.forEach(row => {
            // Buscamos solo en las columnas de Número, Cliente y RUC
            let text = row.innerText.toLowerCase();
            row.style.display = text.includes(input) ? "" : "none";
        });
    });
</script>

{% endblock %}